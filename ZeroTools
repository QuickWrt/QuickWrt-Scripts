#!/bin/sh

# =============================================================================
# ZeroTools - ZeroWrt ä¸“ä¸šçº§å·¥å…·ç®±
# Version: v1.0.1 | Author: OPPEN321
# Repository: https://gitea.kejizero.xyz/zhao/ZeroTools
# =============================================================================

# å®šä¹‰å…¨å±€é¢œè‰²
RED_COLOR='\e[1;31m'
GREEN_COLOR='\e[1;32m'
YELLOW_COLOR='\e[1;33m'
BLUE_COLOR='\e[1;34m'
MAGENTA_COLOR='\e[1;35m'
CYAN_COLOR='\e[1;36m'
GOLD_COLOR='\e[1;33m'
BOLD='\e[1m'
RESET='\e[0m'

# å½“å‰è„šæœ¬ç‰ˆæœ¬å·
version='v1.0.1 (2025.11.30)'

# å„å˜é‡é»˜è®¤å€¼
author="OPPEN321"
blog="www.kejizero.xyz"
mirror="https://zerowrt.kejizero.xyz"
api_url="https://gitea.kejizero.xyz/zhao/ZeroTools/raw/branch/main/ZeroWrt"
device_type="$(jsonfilter -i /etc/board.json -e '@.model.name' 2>/dev/null)"
lan_ip=$(ip -4 addr show br-lan 2>/dev/null | grep -o 'inet [0-9.]*' | awk '{print $2}')
firmware_info="ä¼šå‘˜ä¸“äº«ç‰ˆæœ¬"
kernel_version=$(uname -r)
net_status=$(ping -c1 -W1 223.5.5.5 >/dev/null 2>&1 && echo "å·²è”ç½‘" || echo "æœªè”ç½‘")

# æ£€æµ‹èº«ä»½ä¿¡æ¯
if [ $(id -u) != "0" ]; then
    echo "é”™è¯¯ï¼šæ‚¨å¿…é¡»ä»¥ root ç”¨æˆ·èº«ä»½è¿è¡Œæ­¤ zerotoolsï¼Œè¯·ä½¿ç”¨ root ç”¨æˆ·ã€‚"
    exit 1
fi

if ! grep -qi -E "OpenWrt|QWRT" /etc/openwrt_release; then
    echo "é”™è¯¯ï¼šæ‚¨çš„ç³»ç»Ÿä¸æ”¯æŒ zerotoolsï¼"
    exit 1
fi


# æ‰“å°æ¨ªå¹…åŠèœå•
Options_Menu() {
    clear
    echo -e ""
    echo -e "${BOLD}${BLUE_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}${BLUE_COLOR}                    ğŸ› ï¸  ZeroTools å·¥å…·ç®± ${RESET}"
    echo -e "${BOLD}${BLUE_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}${CYAN_COLOR}ğŸ‘¨â€ğŸ’» å¼€å‘è€…: $author${RESET}"
    echo -e "${BOLD}${CYAN_COLOR}ğŸŒ åšå®¢: $blog${RESET}"
    echo -e "${BOLD}${CYAN_COLOR}ğŸ’¡ ç†å¿µ: å¼€æº Â· å®šåˆ¶åŒ– Â· é«˜æ€§èƒ½${RESET}"
    echo -e "${BOLD}${CYAN_COLOR}ğŸ“¦ ç‰ˆæœ¬: $version${RESET}"
    echo -e "${BOLD}${BLUE_COLOR}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
    echo -e "${BOLD}${GREEN_COLOR}ğŸ–¥ï¸  è®¾å¤‡ç±»å‹: ${device_type}${RESET}"
    echo -e "${BOLD}${GREEN_COLOR}ğŸŒ  LAN å£ IP: ${lan_ip}${RESET}"
    echo -e "${BOLD}${GREEN_COLOR}ğŸ“¦  å›ºä»¶ä¿¡æ¯: ${firmware_info}${RESET}"
    echo -e "${BOLD}${GREEN_COLOR}ğŸ§¬ å†…æ ¸ç‰ˆæœ¬: ${kernel_version}${RESET}"
    echo -e "${BOLD}${GREEN_COLOR}ğŸ“¡ è”ç½‘çŠ¶æ€: ${net_status}${RESET}"
    echo -e "${BOLD}${BLUE_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "  ${BOLD}${YELLOW}1.${RESET} ${CYAN_COLOR}SetIP${RESET}           ${WHITE}â”€${RESET} ${GREEN_COLOR}è®¾ç½® IP${RESET}"
    echo -e "  ${BOLD}${YELLOW}2.${RESET} ${CYAN_COLOR}Network_Wizard${RESET}  ${WHITE}â”€${RESET} ${GREEN_COLOR}ç½‘ç»œå‘å¯¼${RESET}" 
    echo -e "  ${BOLD}${YELLOW}3.${RESET} ${CYAN_COLOR}Apply_repo${RESET}      ${WHITE}â”€${RESET} ${GREEN_COLOR}è½¯ä»¶æºé…ç½®${RESET}"
    echo -e "  ${BOLD}${YELLOW}4.${RESET} ${CYAN_COLOR}Diagnostics${RESET}     ${WHITE}â”€${RESET} ${GREEN_COLOR}ç½‘ç»œè¯Šæ–­${RESET}"
    echo -e "  ${BOLD}${YELLOW}5.${RESET} ${CYAN_COLOR}Debug${RESET}           ${WHITE}â”€${RESET} ${GREEN_COLOR}æŠ“å–æ—¥å¿—${RESET}"
    echo -e "  ${BOLD}${YELLOW}6.${RESET} ${CYAN_COLOR}Catwrt_update${RESET}   ${WHITE}â”€${RESET} ${GREEN_COLOR}æ£€æŸ¥æ›´æ–°${RESET}"
    echo -e "  ${BOLD}${YELLOW}7.${RESET} ${CYAN_COLOR}Sysupgrade${RESET}      ${WHITE}â”€${RESET} ${GREEN_COLOR}ç³»ç»Ÿæ›´æ–°${RESET}"
    echo -e "  ${BOLD}${YELLOW}8.${RESET} ${CYAN_COLOR}Restore${RESET}         ${WHITE}â”€${RESET} ${GREEN_COLOR}æ¢å¤è½¯ä»¶åŒ…${RESET}"
    echo -e "  ${BOLD}${YELLOW}9.${RESET} ${CYAN_COLOR}Utilities(more)${RESET} ${WHITE}â”€${RESET} ${GREEN_COLOR}å®ç”¨å·¥å…·${RESET}"
    echo -e "  ${BOLD}${YELLOW}0.${RESET} ${CYAN_COLOR}Exit${RESET}            ${WHITE}â”€${RESET} ${GREEN_COLOR}é€€å‡º${RESET}"
    echo -e "${BOLD}${BLUE_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}${MAGENTA}ğŸ¯ è¯·é€‰æ‹©æ“ä½œ ${WHITE}[${YELLOW}0-9${WHITE}]${RESET} ${CYAN}â–ºâ–º${RESET} "
    echo -ne "${BOLD}${GREEN}ğŸ’« è¾“å…¥æ•°å­— ${WHITE}Â»${RESET} ${BOLD}${WHITE}"
}

# è®¾ç½®é»˜è®¤åœ°å€
Set_IP() {
    DEFAULT_IP="10.0.0.1"
    
    echo -e "\n${PURPLE}ğŸŒ IPåœ°å€é…ç½®ä¸­å¿ƒ${NC}"
    echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    while true; do
        echo -e "${YELLOW}ğŸ“ è¯·è¾“å…¥IPåœ°å€${NC}"
        echo -e "${GREEN}ğŸ’« é»˜è®¤åœ°å€: $DEFAULT_IP${NC}"
        echo -e "${BLUE}ğŸ’¡ æç¤º: è¾“å…¥ '0' è¿”å›ä¸»èœå•${NC}"
        echo -ne "${BLUE}â¤ ${NC}"
        read input_ip
        
        # æ£€æŸ¥æ˜¯å¦è¿”å›ä¸»èœå•
        if [[ "$input_ip" == "0" ]]; then
            echo -e "${YELLOW}âª è¿”å›ä¸»èœå•...${NC}"
            return 1
        fi
        
        if [ -z "$input_ip" ]; then
            input_ip=$DEFAULT_IP
            echo -e "${GREEN}âœ… ä½¿ç”¨é»˜è®¤IPåœ°å€: $input_ip${NC}"
        fi

        if echo "$input_ip" | grep -Eo '^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$' >/dev/null; then
            echo -e "${GREEN}ğŸ¯ IPåœ°å€æ ¼å¼éªŒè¯é€šè¿‡${NC}"
            break
        else
            echo -e "${RED}âŒ éæ³•çš„IPåœ°å€æ ¼å¼ï¼Œè¯·é‡æ–°è¾“å…¥${NC}"
            echo -e "${YELLOW}ğŸ’¡ æ­£ç¡®æ ¼å¼ç¤ºä¾‹: 192.168.1.1${NC}"
        fi
    done

    echo -e "\n${BLUE}ğŸ”„ æ­£åœ¨åº”ç”¨ç½‘ç»œé…ç½®...${NC}"
    uci set network.lan.ipaddr="$input_ip"
    uci commit network
    
    echo -e "${GREEN}âœ… LAN å£ IP å·²æˆåŠŸæ›´æ”¹ä¸º $input_ip${NC}"
    echo -e "${YELLOW}â³ ç³»ç»Ÿå°†åœ¨ 5 ç§’åè‡ªåŠ¨é‡å¯ï¼Œè¯·ä½¿ç”¨æ–°çš„ IP åœ°å€é‡æ–°è¿æ¥ã€‚${NC}"
    
    # å€’è®¡æ—¶æç¤º
    for i in {5..1}; do
        echo -e "${CYAN}â° ${i}ç§’åé‡å¯...${NC}"
        sleep 1
    done
    
    echo -e "${GREEN}ğŸš€ æ­£åœ¨é‡å¯ç³»ç»Ÿ...${NC}"
    reboot
}

# ç½‘ç»œå‘å¯¼
Network_Wizard() {
    while true; do
        echo
        echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
        echo -e "${MAGENTA_COLOR}ğŸŒ ç½‘ç»œæ¨¡å¼é€‰æ‹© - Network Mode Selection${RESET}"
        echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
        echo -e "${YELLOW_COLOR}1. PPPoE Mode (æ‹¨å·æ¨¡å¼)${RESET}"
        echo -e "${YELLOW_COLOR}2. DHCP Mode (DHCPæ¨¡å¼)${RESET}" 
        echo -e "${YELLOW_COLOR}3. Bypass Gateway Mode (æ—è·¯ç½‘å…³æ¨¡å¼)${RESET}"
        echo -e "${RED_COLOR}0. Exit /// é€€å‡º${RESET}"
        echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
        read -p "è¯·é€‰æ‹©ç½‘ç»œæ¨¡å¼ ([1]PPPoE / [2]DHCP / [3]æ—è·¯ç½‘å…³ / [0]é€€å‡º): " network_mode
        
        case "$network_mode" in
            1)
                echo
                echo -e "${GREEN_COLOR}âœ… Selected PPPoE Mode /// å·²é€‰æ‹© PPPoE æ‹¨å·æ¨¡å¼${RESET}"
                pppoe_mode
                break
                ;;
            2)
                echo
                echo -e "${GREEN_COLOR}âœ… Selected DHCP Mode /// å·²é€‰æ‹© DHCP æ¨¡å¼${RESET}"
                dhcp_mode
                break
                ;;
            3)
                echo
                echo -e "${GREEN_COLOR}âœ… Selected Bypass Gateway Mode /// å·²é€‰æ‹©æ—è·¯ç½‘å…³æ¨¡å¼${RESET}"
                bypass_gateway_mode
                break
                ;;
            0)
                echo -e "${YELLOW_COLOR}âª ç½‘ç»œå‘å¯¼å·²é€€å‡ºã€‚${RESET}"
                return
                ;;
            *)
                echo -e "${RED_COLOR}âŒ æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥${RESET}"
                continue
                ;;
        esac
    done
}

# PPPoE Mode
pppoe_mode() {
    echo
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${MAGENTA_COLOR}ğŸ“ PPPoE æ‹¨å·é…ç½® - PPPoE Dial-up Configuration${RESET}"
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    
    # IPåœ°å€è®¾ç½®
    Set_IP || return 1
    
    echo
    echo -e "${YELLOW_COLOR}ğŸ”§ IPv6 é…ç½®${RESET}"
    read -p "æ˜¯å¦ç¦ç”¨ IPv6 ç½‘ç»œï¼Ÿ([Enter] è·³è¿‡ / [1] ç¦ç”¨): " disable_ipv6
    if [ "$disable_ipv6" == "1" ]; then
        uci delete dhcp.lan.dhcpv6
        uci delete dhcp.lan.ra
        uci delete dhcp.lan.ra_management
        uci delete network.lan.ip6assign
        echo -e "${GREEN_COLOR}âœ… IPv6 å·²ç¦ç”¨${RESET}"
    fi

    echo
    echo -e "${YELLOW_COLOR}ğŸ“ PPPoE è´¦å·å¯†ç ${RESET}"
    echo -e "${BLUE_COLOR}ğŸ’¡ å¦‚ä¸çŸ¥é“è´¦å·å¯†ç ï¼Œå¯ä»¥å¯»æ±‚å®½å¸¦å¸ˆå‚…ï¼Œå¿…é¡»è¦æ­£ç¡®å¡«å†™!${RESET}"
    read -p "[PPPoE] è¯·è¾“å…¥å®½å¸¦è´¦å·: " username
    read -s -p "[PPPoE] è¯·è¾“å…¥å®½å¸¦å¯†ç : " password
    echo
    uci set network.wan.proto=pppoe
    uci set network.wan.username=$username
    uci set network.wan.password=$password
    echo -e "${GREEN_COLOR}âœ… PPPoE æ‹¨å·é…ç½®å·²å®Œæˆ${RESET}"
    
    common_config
    finalize_config
}

# DHCP Mode
dhcp_mode() {
    echo
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${MAGENTA_COLOR}ğŸŒ DHCP æ¨¡å¼é…ç½® - DHCP Mode Configuration${RESET}"
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    
    # IPåœ°å€è®¾ç½®
    Set_IP || return 1
    
    echo
    echo -e "${YELLOW_COLOR}ğŸ”§ IPv6 é…ç½®${RESET}"
    read -p "æ˜¯å¦ç¦ç”¨ IPv6 ç½‘ç»œï¼Ÿ([Enter] è·³è¿‡ / [1] ç¦ç”¨): " disable_ipv6
    if [ "$disable_ipv6" == "1" ]; then
        uci delete dhcp.lan.dhcpv6
        uci delete dhcp.lan.ra
        uci delete dhcp.lan.ra_management
        uci delete network.lan.ip6assign
        echo -e "${GREEN_COLOR}âœ… IPv6 å·²ç¦ç”¨${RESET}"
    fi

    echo -e "${GREEN_COLOR}âœ… DHCP æ¨¡å¼é…ç½®å®Œæˆ${RESET}"
    
    common_config
    finalize_config
}

# Bypass Gateway Mode
bypass_gateway_mode() {
    echo
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${MAGENTA_COLOR}ğŸ”„ æ—è·¯ç½‘å…³é…ç½® - Bypass Gateway Configuration${RESET}"
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    
    # è¾“å…¥ä¸»è·¯ç”±çš„ IP åœ°å€
    while true; do
        echo
        echo -e "${YELLOW_COLOR}ğŸ“ è¯·è¾“å…¥ä¸»è·¯ç”±çš„ IP åœ°å€${RESET}"
        echo -e "${BLUE_COLOR}ğŸ’¡ ä¾‹å¦‚: 192.168.31.1${RESET}"
        echo -e "${RED_COLOR}âš ï¸  è¾“å…¥ '0' è¿”å›ä¸Šä¸€çº§${RESET}"
        read -p "ä¸»è·¯ç”± IP åœ°å€: " router_ip
        
        if [ "$router_ip" == "0" ]; then
            echo -e "${YELLOW_COLOR}âª è¿”å›ä¸Šä¸€çº§...${RESET}"
            return 1
        fi
        
        if [ -z "$router_ip" ]; then
            echo -e "${RED_COLOR}âŒ ä¸»è·¯ç”± IP åœ°å€ä¸èƒ½ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥ã€‚${RESET}"
        elif ! echo "$router_ip" | grep -Eq '^(10|172\.(1[6-9]|2[0-9]|3[01])|192\.168)\.'; then
            echo -e "${RED_COLOR}âŒ è¾“å…¥çš„ IP åœ°å€æ— æ•ˆï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„å†…ç½‘ IP åœ°å€${RESET}"
        else
            break
        fi
    done

    subnet=$(echo "$router_ip" | cut -d. -f1-3)
    echo
    echo -e "${BLUE_COLOR}ğŸ” æ­£åœ¨æ‰«æ ${subnet}.4 åˆ° ${subnet}.10ï¼ŒæŸ¥æ‰¾æœªè¢«å ç”¨çš„æœ¬æœº IP...${RESET}"
    
    for i in $(seq 4 10); do
        candidate_ip="${subnet}.${i}"
        if ping -c 1 -W 1 "$candidate_ip" >/dev/null 2>&1; then
            echo -e "${YELLOW_COLOR}â³ ${candidate_ip} å·²è¢«å ç”¨ï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª...${RESET}"
        else
            default_device_ip="$candidate_ip"
            echo -e "${GREEN_COLOR}âœ… æ‰¾åˆ°å¯ç”¨çš„ IP åœ°å€ï¼š${default_device_ip}${RESET}"
            break
        fi
    done

    if [ -z "$default_device_ip" ]; then
        echo
        echo -e "${RED_COLOR}âŒ æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„ IP åœ°å€ï¼Œè¯·æ‰‹åŠ¨æŒ‡å®šã€‚${RESET}"
        while true; do
            read -p "è¯·è¾“å…¥æœ¬æœº IP åœ°å€: " device_ip
            if [ -z "$device_ip" ]; then
                echo -e "${RED_COLOR}âŒ IP åœ°å€ä¸èƒ½ä¸ºç©º${RESET}"
            elif ! echo "$device_ip" | grep -Eq '^(10|172\.(1[6-9]|2[0-9]|3[01])|192\.168)\.'; then
                echo -e "${RED_COLOR}âŒ è¾“å…¥çš„ IP åœ°å€æ— æ•ˆï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ IP åœ°å€ã€‚${RESET}"
            else
                break
            fi
        done
    else
        while true; do
            echo
            read -p "å»ºè®®ä½¿ç”¨æœ¬æœº IP åœ°å€ä¸º $default_device_ipï¼ŒæŒ‰å›è½¦ç¡®è®¤æˆ–è¾“å…¥æ–°çš„ IP åœ°å€: " device_ip
            if [ -z "$device_ip" ]; then
                device_ip="$default_device_ip"
                break
            elif ! echo "$device_ip" | grep -Eq '^(10|172\.(1[6-9]|2[0-9]|3[01])|192\.168)\.'; then
                echo -e "${RED_COLOR}âŒ è¾“å…¥çš„ IP åœ°å€æ— æ•ˆï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„ IP åœ°å€ã€‚${RESET}"
            else
                break
            fi
        done
    fi
    
    echo
    echo -e "${GREEN_COLOR}ğŸ“Š é…ç½®ä¿¡æ¯æ±‡æ€»${RESET}"
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${YELLOW_COLOR}ä¸»è·¯ç”± IP åœ°å€ï¼š$router_ip${RESET}"
    echo -e "${YELLOW_COLOR}æœ¬æœº(æ—è·¯ç½‘å…³) IP åœ°å€ï¼š$device_ip${RESET}"
    echo -e "${CYAN_COLOR}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"

    # DNSè®¾ç½®
    echo
    echo -e "${YELLOW_COLOR}ğŸŒ DNS æœåŠ¡å™¨è®¾ç½®${RESET}"
    read -p "ä½¿ç”¨æ¨èçš„ DNS æœåŠ¡å™¨ 223.6.6.6 223.5.5.5 å—ï¼Ÿ([Enter] ç¡®è®¤ / [0] è·³è¿‡): " use_dns
    if [ "$use_dns" = "0" ]; then
        echo -e "${YELLOW_COLOR}â© è·³è¿‡ DNS è®¾ç½®${RESET}"
    elif [ -z "$use_dns" ]; then
        uci set network.lan.dns="223.6.6.6 223.5.5.5"
        echo -e "${GREEN_COLOR}âœ… å·²è®¾ç½®æ¨è DNS æœåŠ¡å™¨${RESET}"
    else
        if [[ $use_dns =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}(\s+([0-9]{1,3}\.){3}[0-9]{1,3})*$ ]]; then
            uci set network.lan.dns="$use_dns"
            echo -e "${GREEN_COLOR}âœ… å·²è®¾ç½®è‡ªå®šä¹‰ DNS æœåŠ¡å™¨${RESET}"
        else
            echo -e "${RED_COLOR}âŒ æ— æ•ˆçš„ DNS æ ¼å¼${RESET}"
            return 1
        fi
    fi

    # é…ç½®ç½‘ç»œ
    echo
    echo -e "${BLUE_COLOR}ğŸ”„ æ­£åœ¨åº”ç”¨ç½‘ç»œé…ç½®...${RESET}"
    uci set network.lan.ipaddr="$device_ip"
    uci set network.lan.gateway="$router_ip"
    uci set network.lan.proto='static'
    uci commit network

    # ç¦ç”¨ IPv6
    uci set dhcp.lan.dhcpv6='disabled'
    uci set dhcp.lan.ra='disabled'
    uci commit dhcp

    # ç¦ç”¨ DHCP æœåŠ¡
    uci set dhcp.lan.ignore='1'
    uci delete dhcp.lan.leasetime
    uci delete dhcp.lan.limit
    uci delete dhcp.lan.start
    uci commit dhcp

    echo -e "${GREEN_COLOR}âœ… æ—è·¯ç½‘å…³é…ç½®å®Œæˆ!${RESET}"
    echo -e "${GREEN_COLOR}ğŸ“¡ æœ¬æœº IP: $device_ip${RESET}"

    # é‡å¯æœåŠ¡
    /etc/init.d/network restart
    /etc/init.d/firewall restart
    /etc/init.d/dnsmasq restart

    echo
    echo -e "${YELLOW_COLOR}âš ï¸  å¦‚å‡ºç° Warning æ˜¯å› ä¸ºæ—è·¯é˜²ç«å¢™æ˜¯è¿™æ ·æŠ¥é”™çš„ï¼Œéƒ¨åˆ†é…ç½®å¯ä»¥å¿½ç•¥ä¸å½±å“ä½¿ç”¨${RESET}"
}

# ä¸»æ‰§è¡Œé€»è¾‘
main() {
    while true; do
        Options_Menu
        read choice
        
        case $choice in
            1)
                Set_IP
                ;;
            2)
                Network_Wizard
                ;;
            0)
                echo -e "${YELLOW_COLOR}æ„Ÿè°¢ä½¿ç”¨ ZeroToolsï¼Œå†è§ï¼${RESET}"
                exit 0
                ;;
            *)
                echo -e "${RED_COLOR}æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥ï¼${RESET}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
        esac
    done
}

main "$@"
